# [功能名稱] - 需求確認書

**文件版本**: 1.0
**建立日期**: YYYY-MM-DD
**最後更新**: YYYY-MM-DD
**專案名稱**: [YourProject]
**功能名稱**: [English Feature Name]

---

## 一、功能概述

<!-- TODO: 1-2 段說明此功能的目的與價值 -->

[描述功能的核心價值主張,說明為什麼需要此功能]

[說明此功能與現有系統的關係]

---

## 二、核心需求確認

### 2.1 功能需求

<!-- TODO: 列出所有功能需求,使用編號 FR1, FR2, ... -->

#### FR1: [需求標題]

**需求描述**: [詳細描述]

**優先級**: 必須 / 應該 / 可以

**驗收標準**:
- [ ] [可驗證的標準 1]
- [ ] [可驗證的標準 2]

#### FR2: [需求標題]

...

### 2.2 非功能需求

<!-- TODO: 效能、安全、可用性等需求 -->

#### NFR1: 效能需求

- **目標**: [具體數字,如「< 5ms」]
- **測試方法**: [如何驗證]

#### NFR2: 安全需求

- **目標**: [安全要求]
- **實作方式**: [簡要說明]

### 2.3 資料流程

<!-- TODO: 繪製資料流程圖 -->

```
[資料來源]
    ↓
[處理步驟 1]
    ↓
[處理步驟 2]
    ↓
[最終輸出]
```

---

## 三、技術方案概要

### 3.1 資料庫設計

<!-- TODO: 列出新增或修改的資料表 -->

#### 新增資料表

| 資料表名稱 | 用途 | 關鍵欄位 |
|-----------|------|---------|
| [TableName] | [用途說明] | [欄位 1, 欄位 2, ...] |

### 3.2 核心技術選型

<!-- TODO: 說明使用的演算法、框架、套件 -->

- **演算法**: [演算法名稱與用途]
- **NuGet 套件**: [套件名稱] v[版本]
- **其他技術**: [說明]

### 3.3 架構設計

<!-- TODO: 說明分層架構與元件關係 -->

#### 元件清單

| 層級 | 元件名稱 | 用途 |
|-----|---------|------|
| **Domain** | [EntityName] | [說明] |
| **Infrastructure** | [RepositoryName] | [說明] |
| **Application** | [ServiceName] | [說明] |
| **API** | [ControllerName] | [說明] |

### 3.4 資料流程圖

<!-- TODO: 繪製完整的資料流程圖 -->

```
┌─────────────────┐
│  [Step 1]       │
└────────┬────────┘
         ↓
┌─────────────────┐
│  [Step 2]       │
└─────────────────┘
```

---

## 四、新舊架構比較

<!-- 🔴 如果是新功能,此章節必填 -->
<!-- 🟡 如果是獨立新模組,可簡化或省略 -->

### 4.1 現有架構 (舊版)

#### 架構圖

<!-- TODO: 繪製現有架構圖 -->

```
[舊版架構圖]
```

#### 現有元件清單

| 層級 | 元件 | 說明 |
|-----|------|------|
| **Domain** | [ExistingEntity] | [說明] |
| **Application** | [ExistingService] | [說明] |

#### 現有邏輯

```csharp
// TODO: 引用現有程式碼片段
// File:LineNumber
```

---

### 4.2 新架構 (新版)

#### 架構圖

<!-- TODO: 繪製新版架構圖 -->

```
[新版架構圖,標註 [NEW] 的部分]
```

#### 新增元件清單

| 層級 | 元件 | 說明 |
|-----|------|------|
| **Domain** | [NewEntity] (NEW) | [說明] |
| **Application** | [NewService] (NEW) | [說明] |

#### 新增邏輯

```csharp
// TODO: 新增的程式碼片段
```

---

### 4.3 新舊架構對比表

| 項目 | 舊版架構 | 新版架構 | 差異 |
|-----|---------|---------|------|
| **[比較項目 1]** | [舊版] | [新版] | ✅/❌/⚠️ [說明] |
| **[比較項目 2]** | [舊版] | [新版] | ✅/❌/⚠️ [說明] |

---

### 4.4 記憶體/效能影響對比

<!-- TODO: 量化新架構的資源影響 -->

| 資料量 | 舊版記憶體 | 新版記憶體 | 增加量 |
|-------|-----------|-----------|--------|
| [場景 1] | [數字] MB | [數字] MB | +[數字] MB |
| [場景 2] | [數字] MB | [數字] MB | +[數字] MB |

**結論**: [影響評估]

---

## 五、新舊流程比較

<!-- 🔴 如果是新功能,此章節必填 -->
<!-- 🟡 如果流程無變更,可簡化說明 -->

### 5.1 現有流程 (舊版)

#### 完整流程圖

<!-- TODO: 繪製舊版流程圖 -->

```
┌────────────────┐
│ [舊版 Step 1]  │
└───────┬────────┘
        ↓
┌────────────────┐
│ [舊版 Step 2]  │
└────────────────┘
```

#### 關鍵時間點

| 時間點 | 動作 | 耗時 |
|-------|------|------|
| T0 | [動作] | - |
| T0 + [時間] | [動作] | [耗時] |

**總延遲**: [總計]

---

### 5.2 新流程 (新版)

#### 完整流程圖

<!-- TODO: 繪製新版流程圖,標註 [NEW] 的步驟 -->

```
┌────────────────┐
│ [新版 Step 1]  │
└───────┬────────┘
        ↓
┌────────────────┐
│ [NEW Step 2]   │
└────────────────┘
```

#### 關鍵時間點

| 時間點 | 動作 | 耗時 |
|-------|------|------|
| T0 | [動作] | - |
| T0 + [時間] | **[NEW] [動作]** | **[耗時]** |

**總延遲**: [總計]
**檢查耗時**: 新版 [X]ms vs 舊版 [Y]ms

---

### 5.3 流程對比表

| 流程階段 | 舊版流程 | 新版流程 | 差異 |
|---------|---------|---------|------|
| **Step 1** | [舊版] | [新版] | ✅/❌ [說明] |
| **Step 2** | [舊版] | [新版] | ✅ [說明] |

---

### 5.4 多種模式的流程比較 (可選)

<!-- TODO: 如果有多種執行模式,說明每種模式的流程 -->

#### 模式 A: [模式名稱]

```
[流程圖]
```

**適用場景**: [說明]

#### 模式 B: [模式名稱]

```
[流程圖]
```

**適用場景**: [說明]

---

### 5.5 效能影響分析

#### 單則訊息處理耗時對比

| 場景 | 舊版耗時 | 新版耗時 | 差異 |
|-----|---------|---------|------|
| **[場景 1]** | [X] ms | [Y] ms | +/- [Z] ms |
| **[場景 2]** | [X] ms | [Y] ms | +/- [Z] ms |

**結論**: [影響說明]

#### 批次處理效能對比

| 場景 | 舊版總耗時 | 新版總耗時 | 差異 |
|-----|----------|----------|------|
| **[場景 1]** | [X] 秒 | [Y] 秒 | ↓/↑ [%] |
| **[場景 2]** | [X] 秒 | [Y] 秒 | ↓/↑ [%] |

**結論**: [影響說明]

---

## 六、API 介面

<!-- 🟡 如果沒有 API 變更,可省略此章節 -->

### 6.1 [API 端點 1 名稱]

**端點**: `[METHOD] /[path]`

**查詢參數**:
- `param1` (required/optional): [說明]

**請求 Body**: (如適用)
```json
{
  "key": "value"
}
```

**回應**:
```json
{
  "result": "success"
}
```

**錯誤代碼**:
- `400`: [錯誤說明]
- `404`: [錯誤說明]

**權限**: Admin / User / Public

---

### 6.2 [API 端點 2 名稱]

<!-- TODO: 重複上述格式 -->

---

## 七、設定參數

### 7.1 appsettings.json 新增項目

```json
{
  "AppSettings": {
    // ... 現有設定

    // 🆕 新增設定
    "[NewSetting1]": "[預設值]",
    "[NewSetting2]": "[預設值]"
  }
}
```

### 7.2 設定說明

| 參數 | 可選值 | 預設值 | 說明 |
|-----|-------|--------|------|
| [Setting1] | [值1]<br>[值2] | [預設] | [用途說明] |
| [Setting2] | [數字範圍] | [預設] | [用途說明] |

### 7.3 設定模式說明 (可選)

<!-- TODO: 如果有多種設定模式,詳細說明每種模式 -->

#### 模式 A: [模式名稱]

```
[流程或行為說明]
```

**適用場景**: [說明]

---

## 八、實作範圍

### 8.1 新增檔案清單

#### Domain 層
- `[YourProject].Domain/Entities/[EntityName].cs` - [用途]
- `[YourProject].Domain/Interfaces/[InterfaceName].cs` - [用途]

#### Infrastructure 層
- `[YourProject].Infrastructure/Repositories/[RepositoryName].cs` - [用途]

#### Application 層
- `[YourProject].Application/[ServiceName].cs` - [用途]

#### API 層
- `[YourProject]/Controllers/[ControllerName].cs` - [用途]

#### Job 層
- `[YourProject]/Jobs/[JobName].cs` - [用途]

#### 資料庫
- 更新 `[YourProject]/assets/[database-file]` 模板（新增 [N] 個資料表）

---

### 8.2 修改檔案清單

- `[File1.cs]`
  - [修改說明 1]
  - [修改說明 2]

- `[File2.cs]`
  - [修改說明]

- `appsettings.json`
  - 新增設定參數

- `Program.cs`
  - [修改說明]

- `CLAUDE.md`
  - 新增功能說明章節

- `README.md`
  - 更新功能清單與 API 文件

---

### 8.3 依賴套件

**新增 NuGet 套件**:

- **套件名稱**: `[PackageName]`
- **版本**: [版本號]
- **用途**: [說明]
- **授權**: [授權類型]
- **安裝指令**:
  ```bash
  dotnet add [ProjectName] package [PackageName] --version [版本]
  ```

---

## 九、測試計畫

### 9.1 單元測試

#### [測試類別 1] 測試

- ✅ [測試案例 1]
- ✅ [測試案例 2]
- ✅ [測試案例 3]

#### [測試類別 2] 測試

- ✅ [測試案例 1]
- ✅ [測試案例 2]

---

### 9.2 效能測試

| 測試項目 | 資料量 | 目標耗時 |
|---------|-------|---------|
| [項目 1] | [數量] | < [時間] |
| [項目 2] | [數量] | < [時間] |

**記憶體測試**:
- [場景 1]: 記憶體使用量 < [數字] MB
- [場景 2]: 記憶體使用量 < [數字] MB

---

### 9.3 整合測試

#### 端到端流程測試

1. **流程 A: [名稱]**
   - [步驟 1] → [預期結果] ✓
   - [步驟 2] → [預期結果] ✓

2. **流程 B: [名稱]**
   - [步驟 1] → [預期結果] ✓
   - [步驟 2] → [預期結果] ✓

#### API 端點測試

- [API 1] CRUD 操作 ✓
- [API 2] 權限控制測試 ✓
- [API 3] 錯誤處理測試 ✓

---

### 9.4 壓力測試 (可選)

- 高併發請求 ([數量] requests/sec)
- 大量資料處理 ([數量] 筆資料)
- 記憶體洩漏測試 (長時間運行)

---

## 十、預期效益

### 10.1 業務效益

<!-- TODO: 質化描述業務價值 -->

1. **[效益 1]**: [說明]
2. **[效益 2]**: [說明]
3. **[效益 3]**: [說明]

### 10.2 技術效益

<!-- TODO: 質化描述技術改善 -->

1. **[效益 1]**: [說明]
2. **[效益 2]**: [說明]
3. **[效益 3]**: [說明]

### 10.3 可量化指標

假設 [使用情境說明]:

| 指標 | 現況 | 新功能上線後 | 改善幅度 |
|-----|------|------------|---------|
| [指標 1] | [數字] | [數字] | **↓/↑ [%]** |
| [指標 2] | [數字] | [數字] | **↓/↑ [%]** |
| [指標 3] | [數字] | [數字] | **↓/↑ [%]** |

*以上數據為預估值,實際效果依 [條件] 而定

---

## 十一、風險與限制

### 11.1 技術限制

<!-- TODO: 列出 3-5 個技術限制 -->

1. **[限制 1]**:
   - [具體說明]
   - [影響範圍]

2. **[限制 2]**:
   - [具體說明]
   - [影響範圍]

### 11.2 業務風險

<!-- TODO: 列出 2-3 個業務風險 -->

1. **[風險 1]**:
   - [風險說明]
   - [可能影響]

2. **[風險 2]**:
   - [風險說明]
   - [可能影響]

### 11.3 緩解措施

| 風險 | 緩解措施 |
|-----|---------|
| [風險 1] | [對策說明] |
| [風險 2] | [對策說明] |
| [風險 3] | [對策說明] |

---

## 十二、實作時程估算

### 12.1 分階段工時估算

| 階段 | 工作項目 | 詳細任務 | 預估工時 |
|-----|---------|---------|---------|
| **階段 1** | [項目 1] | - [任務 1]<br>- [任務 2] | **[X] 小時** |
| **階段 2** | [項目 2] | - [任務 1]<br>- [任務 2] | **[X] 小時** |
| **階段 3** | [項目 3] | - [任務 1]<br>- [任務 2] | **[X] 小時** |
| **總計** | | | **[總計] 小時** |

### 12.2 里程碑規劃

| 里程碑 | 完成標準 | 預計完成日 |
|-------|---------|-----------|
| M1: [名稱] | [完成標準] | D+[天數] |
| M2: [名稱] | [完成標準] | D+[天數] |
| M3: [名稱] | [完成標準] | D+[天數] |
| M4: 交付 | [完成標準] | D+[天數] |

*D = 開始日期

---

## 十三、待客戶確認事項

### ✅ 已確認需求（請勾選）

以下需求已在第二章詳細說明,請確認:

- [ ] [需求 1]
- [ ] [需求 2]
- [ ] [需求 3]
- [ ] [需求 4]

---

### ❓ 待決策問題

#### 問題 1: [問題描述]

**選項**:
- A. [選項 A 說明]
- B. [選項 B 說明]
- C. [選項 C 說明]

**建議**: [建議選項與理由]

**客戶回覆**: ___________________________

---

#### 問題 2: [問題描述]

**選項**:
- A. [選項 A 說明]
- B. [選項 B 說明]

**建議**: [建議選項與理由]

**客戶回覆**: ___________________________

---

#### 問題 3: [其他建議或疑慮]

**客戶回覆**: ___________________________

---

## 十四、客戶簽核

### 需求確認聲明

本人已詳閱本需求確認書,並確認以下事項:

- [ ] 我已詳閱「第二章:核心需求確認」,確認功能需求無誤
- [ ] 我已詳閱「第三章:技術方案概要」,確認技術方案可行
- [ ] 我已詳閱「第十章:預期效益」,確認符合業務需求
- [ ] 我已了解「第十一章:風險與限制」中的技術限制與業務風險
- [ ] 我已回覆「第十三章:待客戶確認事項」中的問題
- [ ] 我同意「第十二章:實作時程估算」中的開發時程（[X] 小時）

### 變更管理

若需求有任何變更,雙方同意:

1. 需求變更需重新簽核需求確認書
2. 影響時程的變更需重新評估工時
3. 重大變更需重新進行技術評估

### 簽核資訊

**客戶簽核人**: ___________________________

**簽核日期**: ___________________________

**公司名稱**: ___________________________

**職稱**: ___________________________

---

## 附錄 A: 資料表結構

<!-- 🟡 如果有新增或修改資料表,此附錄必填 -->

### A.1 [資料表名稱]

```sql
CREATE TABLE [TableName] (
    [Column1] [DataType] PRIMARY KEY,
    [Column2] [DataType] NOT NULL,
    [Column3] [DataType],
    [CreateTime] TEXT NOT NULL,
    [UpdateTime] TEXT NOT NULL
);

CREATE INDEX idx_[indexname] ON [TableName]([Column]);
```

**欄位說明**:

| 欄位名稱 | 資料類型 | 必填 | 說明 |
|---------|---------|-----|------|
| [Column1] | [Type] | ✓ | [說明] |
| [Column2] | [Type] | ✓ | [說明] |
| [Column3] | [Type] |   | [說明] |

---

## 附錄 B: DTO 定義

<!-- 🟡 如果有新增 API 或資料傳輸物件,此附錄必填 -->

### B.1 [DTO 名稱]

```csharp
/// <summary>
/// [用途說明]
/// </summary>
public class [DtoName]
{
    /// <summary>
    /// [欄位說明]
    /// </summary>
    public int Id { get; set; }

    /// <summary>
    /// [欄位說明]
    /// </summary>
    public string Name { get; set; }
}
```

---

## 附錄 C: 列舉型別定義

<!-- 🟡 如果有新增 enum,此附錄必填 -->

### C.1 [列舉名稱]

```csharp
/// <summary>
/// [用途說明]
/// </summary>
public enum [EnumName]
{
    /// <summary>
    /// [值說明]
    /// </summary>
    [Value1] = 0,

    /// <summary>
    /// [值說明]
    /// </summary>
    [Value2] = 1
}
```

---

## 附錄 D: 演算法說明

<!-- 🟡 如果使用複雜演算法,此附錄必填 -->

### D.1 [演算法名稱]

**演算法原理**:
[說明演算法的核心概念]

**時間複雜度**: O([複雜度])

**空間複雜度**: O([複雜度])

**適用場景**:
- [場景 1]
- [場景 2]

**範例**:
```csharp
// 演算法實作範例
```

---

**文件結束**

---

**版本歷史**:
- v1.0 (YYYY-MM-DD): 初版發行
