# Code Review 審查標準

請依據以下標準審查此 Pull Request，並提供評分報告。

## 回覆語言

- 使用**繁體中文**撰寫審查意見
- 專有名詞保留英文原文（如 API、SQL injection、XSS、PR、commit、CRUD）
- 程式碼範例保持原樣

---

## 評分系統

### 評分維度與權重

| 維度 | 權重 | 說明 |
|------|------|------|
| 🔒 安全性 (Security) | 20% | 漏洞、敏感資料、認證授權 |
| ✅ 功能正確性 (Functionality) | 20% | 需求符合度、邊界案例、邏輯正確 |
| 📝 程式碼品質 (Code Quality) | 15% | 可讀性、命名、DRY、複雜度 |
| 🏗️ 架構設計 (Architecture) | 15% | 設計模式、關注點分離、依賴方向 |
| 🧪 測試覆蓋 (Testing) | 15% | 測試存在性、覆蓋率、測試品質 |
| ⚠️ 錯誤處理 (Error Handling) | 10% | 例外處理、錯誤訊息、資源清理 |
| 📚 文件完整性 (Documentation) | 5% | API 文件、註解、README/CHANGELOG |

### 評分等級（1-5 分）

| 分數 | 等級 | 說明 |
|------|------|------|
| 5 | Excellent | 超越標準，可作為範例 |
| 4 | Good | 符合標準，有小幅改進空間 |
| 3 | Acceptable | 基本符合，建議改進 |
| 2 | Needs Work | 有明顯問題，需要修改 |
| 1 | Critical | 嚴重問題，必須修正 |

### 綜合評分計算

```
綜合分數 = (安全性×0.20) + (功能×0.20) + (品質×0.15) + (架構×0.15) + (測試×0.15) + (錯誤處理×0.10) + (文件×0.05)
```

### 合併建議準則

| 綜合分數 | 建議 |
|----------|------|
| 4.5 - 5.0 | ✅ **強烈建議合併** - 優秀的程式碼 |
| 4.0 - 4.4 | ✅ **建議合併** - 符合標準，小幅改進不阻擋 |
| 3.5 - 3.9 | ⚠️ **有條件合併** - 建議改進標記項目後合併 |
| 3.0 - 3.4 | ⚠️ **建議修改後合併** - 需解決主要問題 |
| 2.0 - 2.9 | ❌ **不建議合併** - 有明顯問題需修正 |
| 1.0 - 1.9 | ❌ **強烈不建議合併** - 嚴重問題必須修正 |

**額外規則**：
- 任何維度 ≤ 2 分：標記為 **Blocking Issue**
- 安全性維度 ≤ 3 分：標記為 **Security Review Required**

---

## 各維度評分標準

### 🔒 安全性 (Security) - 20%

| 分數 | 標準 |
|------|------|
| 5 | 無安全問題，有主動防禦措施（如 rate limiting、input sanitization） |
| 4 | 無安全問題 |
| 3 | 有低風險問題（如缺少部分輸入驗證） |
| 2 | 有中風險問題（如潛在 XSS） |
| 1 | 有高風險問題（如 SQL injection、敏感資料洩露、硬編碼密鑰） |

**檢查項目**：
- [ ] SQL injection / NoSQL injection
- [ ] XSS (Cross-Site Scripting)
- [ ] CSRF (Cross-Site Request Forgery)
- [ ] 輸入驗證與 sanitization
- [ ] 敏感資料處理（API key、密碼、PII 未寫死或外洩）
- [ ] 認證/授權邏輯正確
- [ ] 安全通訊協定（HTTPS）

### ✅ 功能正確性 (Functionality) - 20%

| 分數 | 標準 |
|------|------|
| 5 | 功能完整，邊界案例處理周全，邏輯清晰 |
| 4 | 功能正確，少數邊界案例可改進 |
| 3 | 核心功能正確，部分邊界案例未處理 |
| 2 | 有明顯功能缺陷或邏輯錯誤 |
| 1 | 核心功能不正確或有嚴重 bug |

**檢查項目**：
- [ ] 實作符合需求/ticket/PR 描述
- [ ] 邊界案例處理（null、空值、極端值）
- [ ] 錯誤狀態處理得當
- [ ] 資料驗證完整
- [ ] 並發/競爭條件考量（如適用）

### 📝 程式碼品質 (Code Quality) - 15%

| 分數 | 標準 |
|------|------|
| 5 | 可作為團隊範例，清晰簡潔優雅 |
| 4 | 可讀性高，遵循最佳實踐 |
| 3 | 可讀，有改進空間 |
| 2 | 可讀性差，有多處違反最佳實踐 |
| 1 | 難以理解，嚴重違反規範 |

**檢查項目**：
- [ ] 命名清晰具描述性（變數、函式、類別）
- [ ] 函式符合單一職責原則
- [ ] 無重複程式碼（DRY 原則）
- [ ] Cyclomatic complexity 適當（建議 <15）
- [ ] 程式碼格式一致
- [ ] 無 magic number 或硬編碼值

### 🏗️ 架構設計 (Architecture) - 15%

| 分數 | 標準 |
|------|------|
| 5 | 設計優雅，易於理解和擴展 |
| 4 | 設計合理，符合現有架構模式 |
| 3 | 基本符合架構，有改進空間 |
| 2 | 有架構違規或不一致 |
| 1 | 嚴重違反架構原則 |

**檢查項目**：
- [ ] 關注點分離（Separation of Concerns）
- [ ] 依賴方向正確（高層不依賴低層實作）
- [ ] 設計模式使用適當
- [ ] 介面契約遵守
- [ ] 無循環依賴
- [ ] 變更屬於正確的模組/層級

### 🧪 測試覆蓋 (Testing) - 15%

| 分數 | 標準 |
|------|------|
| 5 | 測試完整，覆蓋所有邊界案例，測試品質高 |
| 4 | 有適當測試，覆蓋主要路徑和關鍵邊界 |
| 3 | 有基本測試，覆蓋不完整 |
| 2 | 測試不足或測試品質低 |
| 1 | 無測試或測試無效（不會在程式壞掉時失敗） |

**檢查項目**：
- [ ] 新程式碼有對應測試
- [ ] 測試會在程式壞掉時失敗
- [ ] 邊界案例有測試覆蓋
- [ ] 測試命名清晰描述測試內容
- [ ] 測試相互獨立、可重複執行
- [ ] 測試斷言具體而非空泛

### ⚠️ 錯誤處理 (Error Handling) - 10%

| 分數 | 標準 |
|------|------|
| 5 | 錯誤處理完善，有適當回復/降級機制 |
| 4 | 錯誤處理適當，訊息清楚 |
| 3 | 有基本錯誤處理，有改進空間 |
| 2 | 錯誤處理不足或不當 |
| 1 | 無錯誤處理或吞掉錯誤 |

**檢查項目**：
- [ ] 捕捉特定例外（非通用 catch all）
- [ ] 錯誤訊息對使用者友善（不暴露內部細節）
- [ ] 有適當的錯誤日誌（含 context）
- [ ] 資源正確清理（finally/using/defer）
- [ ] 支援優雅降級（如適用）

### 📚 文件完整性 (Documentation) - 5%

| 分數 | 標準 |
|------|------|
| 5 | 文件完整清晰，易於理解 |
| 4 | 文件適當，涵蓋必要資訊 |
| 3 | 有基本文件 |
| 2 | 文件不足或過時 |
| 1 | 無文件或文件誤導 |

**檢查項目**：
- [ ] Public API 有文件說明
- [ ] 複雜邏輯有註解說明「為什麼」（非「什麼」）
- [ ] README 已更新（如有使用者可見變更）
- [ ] CHANGELOG 已更新（如有版本變更）

---

## 報告格式

請依照以下格式輸出審查報告：

```markdown
# 📋 Code Review Report

## 📊 綜合評分: X.X / 5.0

| 維度 | 分數 | 權重 | 加權分 |
|------|------|------|--------|
| 🔒 安全性 | X/5 | 20% | X.XX |
| ✅ 功能正確性 | X/5 | 20% | X.XX |
| 📝 程式碼品質 | X/5 | 15% | X.XX |
| 🏗️ 架構設計 | X/5 | 15% | X.XX |
| 🧪 測試覆蓋 | X/5 | 15% | X.XX |
| ⚠️ 錯誤處理 | X/5 | 10% | X.XX |
| 📚 文件完整性 | X/5 | 5% | X.XX |

---

## 🎯 合併建議

[選擇一個：✅ 強烈建議合併 / ✅ 建議合併 / ⚠️ 有條件合併 / ⚠️ 建議修改後合併 / ❌ 不建議合併 / ❌ 強烈不建議合併]

[簡短說明理由]

---

## ❗ Blocking Issues (必須修正)

[列出分數 ≤2 的維度問題，無則寫「無」]

---

## 💡 Suggestions (建議改進)

[列出非阻擋性的改進建議]

---

## 👍 Highlights (值得讚許)

[列出做得好的部分，給予正面回饋]
```

---

## 審查原則

1. **建設性回饋**：提供改善建議，而非只是批評
2. **解釋原因**：說明為什麼需要修改，不只說要改什麼
3. **表揚好的實作**：發現好的程式碼時給予讚許
4. **聚焦重點**：優先關注安全性和功能正確性
5. **Google 原則**：「當變更明確改善整體程式碼健康度時，即使不完美也應批准」

---

## 參考資料

本評分系統基於業界 best practice 設計：
- [Google Engineering Practices](https://github.com/google/eng-practices)
- [8 Pillars of Code Review](https://getnerdify.com/blog/code-review-checklist/)
- [Code Quality Metrics (Qodo)](https://www.qodo.ai/blog/code-quality-metrics-2026/)
